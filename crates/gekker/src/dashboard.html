<!DOCTYPE html>
<!--
SPDX-FileCopyrightText: 2025 xfnw
SPDX-License-Identifier: AGPL-3.0-or-later
-->
<html lang=en>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width, initial-scale=1">
<style>html{color-scheme:dark light}body{font-family:monospace,monospace}</style>
<title>gekker</title>
<script>
//@license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt
function boop() {
	fetch("status").then(res => {
		res.json().then(s => update(s));
	});
}
function update(s) {
	document.getElementById("job_status").textContent = s.job_active ? "active" : "dead";
	document.getElementById("job_sent").textContent = s.job_sent;
	document.getElementById("job_total").textContent = s.job_total;
	document.getElementById("autojoin").textContent = s.autojoin;
	document.getElementById("clients").replaceChildren(...s.clients.map((c,i) => {
		var row = document.createElement("tr");
		var slot = document.createElement("td");
		slot.textContent = i;
		row.appendChild(slot);
		if (c) {
			var nick = document.createElement("td");
			nick.textContent = c.nick;
			row.appendChild(nick);
			var active = document.createElement("td");
			active.innerHTML = '<input type=checkbox onclick="tgl(this,'+i+')">';
			active.children[0].checked = c.active;
			row.appendChild(active);
			var raw = document.createElement("td");
			raw.innerHTML = '<button onclick="raw('+i+')">raw</button>';
			row.appendChild(raw);
		}
		return row;
	}));
}
function tgl(t,i) {
	if (t.checked) {
		fetch('activate/'+i,{method:'POST'})
	} else {
		fetch('deactivate/'+i,{method:'POST'})
	}
}
function raw(i) {
	fetch('raw/'+i,{method:'POST',body:prompt('what to send')})
}
//@license-end
</script>
</head>
<body onload="setInterval(boop,1000)">
<h1>gekker</h1>
<p>job <span id=job_status>???</span> <span id=job_sent>???</span>/<span id=job_total>???</span>
<button onclick="fetch('cancel',{method:'POST'})">cancel</button></p>
<p>autojoin <span id=autojoin>???</span>
<button onclick="fetch('autojoin?channel='+encodeURIComponent(prompt('autojoin channel')),{method:'POST'})">set</button>
<button onclick="fetch('autojoin',{method:'POST'})">clear</button></p>
<table>
<thead>
<tr>
<th>slot</th>
<th>nick</th>
<th>active</th>
<th><button onclick="fetch('raw/all',{method:'POST',body:prompt('what to send')})">raw</button></th>
</tr>
</thead>
<tbody id=clients>
</tbody>
</table>
</body>
</html>
